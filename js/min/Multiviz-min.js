var MultiViz={data:null,usChart:null,industryChart:null,roundChart:null,certifiedChart:null,jobTitleChart:null,dataTableChart:null,companiesChart:null,dataCounter:null,draw:function(t){var e=d3.format("0");MultiViz.usChart=dc.geoChoroplethChart("#us-chart"),MultiViz.industryChart=dc.bubbleChart("#industry-chart"),MultiViz.roundChart=dc.bubbleChart("#round-chart"),MultiViz.certifiedChart=dc.rowChart("#certified-chart"),MultiViz.jobTitleChart=dc.rowChart("#job-title-Chart"),MultiViz.companiesChart=dc.barChart("#companies-chart"),MultiViz.dataCounter=dc.dataCount(".dc-data_count"),t.forEach(function(t){t.wage_rate_from=+t.wage_rate_from}),this.data=crossfilter(t);var i=this.data.groupAll();MultiViz.dataCounter.dimension(this.data).group(i);var r=this.data.dimension(function(t){return t.year}),n=r.group(),a=this.data.dimension(function(t){return t.workloc1_state}),u=a.group().reduceCount(),o=this.data.dimension(function(t){return t.soc_name}),c=o.group().reduce(function(t,e){return++t.count,t.sum+=e.wage_rate_from,t.average=t.sum/t.count,"CERTIFIED"==e.status&&(t.certified_count+=1),t.certified_count<.001&&(t.certified_count=0),t},function(t,e){return--t.count,t.sum-=e.wage_rate_from,t.average=t.sum/t.count,"CERTIFIED"==e.status&&(t.certified_count-=1),t.certified_count<.001&&(t.certified_count=0),t},function(){return{count:0,sum:0,average:0,certified_count:0}}),d=this.data.dimension(function(t){return t.status}),l=d.group(),s=this.data.dimension(function(t){return t.job_title}),f=s.group().reduce(function(t,e){return++t.count,t.sum+=e.wage_rate_from,t.average=t.sum/t.count,"CERTIFIED"==e.status&&(t.certified_count+=1),t.certified_count<.001&&(t.certified_count=0),t},function(t,e){return--t.count,t.sum-=e.wage_rate_from,t.average=t.sum/t.count,"CERTIFIED"==e.status&&(t.certified_count-=1),t.certified_count<.001&&(t.certified_count=0),t},function(){return{count:0,sum:0,average:0,certified_count:0}}),h=this.data.dimension(function(t){return t.employer_name}),m=h.group(),g=this.data.dimension(function(t){return Math.round(1*t.wage_rate_from)}),C=g.group(),p=h.group().reduce(function(t,e){return++t.count,t.sum+=e.wage_rate_from,t.average=t.sum/t.count,"CERTIFIED"==e.status&&(t.certified_count+=1),t.certified_count<.001&&(t.certified_count=0),t},function(t,e){return--t.count,t.sum-=e.wage_rate_from,t.average=t.sum/t.count,"CERTIFIED"==e.status&&(t.certified_count-=1),t.certified_count<.001&&(t.certified_count=0),t},function(){return{count:0,sum:0,average:0,certified_count:0}});d3.json("us-states.json",function(t){MultiViz.usChart.width(900).height(500).dimension(a).group(u).colors(d3.scale.quantize().range(["#CCCCCC","#B7C4B7","#A3BCA3","#8EB58E","#7AAD7A","#66A666","#519E51","#3D963D","#288F28","#148714"])).colorDomain([0,200]).colorCalculator(function(t){return t?MultiViz.usChart.colors()(t):"#ccc"}).overlayGeoJson(t.features,"state",function(t){return t.properties.name}).title(function(t){return"State: "+t.key+"\nTotal Applications For H-1 B Visa: "+e(t.value?t.value:0)}),MultiViz.industryChart.width(700).height(250).margins({top:10,right:50,bottom:30,left:70}).dimension(o).group(c).colors(d3.scale.category10()).keyAccessor(function(t){return t.value.count}).valueAccessor(function(t){return t.value.certified_count}).radiusValueAccessor(function(t){return t.value.average}).x(d3.scale.linear().domain([0,80])).y(d3.scale.linear().domain([0,100])).r(d3.scale.linear().domain([0,15e4])).minRadiusWithLabel(15).elasticY(!0).yAxisPadding(50).elasticX(!0).xAxisPadding(50).maxBubbleRelativeSize(.04).renderHorizontalGridLines(!0).renderVerticalGridLines(!0).renderLabel(!0).renderTitle(!0).yAxisLabel("# of Certified (Accepted) Applications").xAxisLabel("# of Total Applications").title(function(t){return t.key+"\nAverage Yearly Salary: "+e(t.value.average)+"\n"+t.value.count+"Applied , and "+t.value.certified_count+" got a visa\n% Acceppted : "+e(t.value.certified_count/t.value.count)}),MultiViz.industryChart.yAxis().tickFormat(function(t){return t+""}),MultiViz.industryChart.xAxis().tickFormat(function(t){return t+""}),MultiViz.certifiedChart.width(180).height(180).margins({top:20,left:10,right:10,bottom:20}).group(l).dimension(d).ordinalColors(["#3182bd","#6baed6","#9ecae1","#c6dbef","#dadaeb"]).label(function(t){return t.key}).title(function(t){return t.value}).elasticX(!0).xAxis().ticks(4),MultiViz.roundChart.width(1e3).height(500).margins({top:10,right:50,bottom:30,left:70}).dimension(s).group(f).colors(d3.scale.category10()).keyAccessor(function(t){return t.value.count}).valueAccessor(function(t){return t.value.certified_count}).radiusValueAccessor(function(t){return t.value.average}).x(d3.scale.linear().domain([0,80])).y(d3.scale.linear().domain([0,100])).r(d3.scale.linear().domain([0,15e4])).minRadiusWithLabel(15).elasticY(!0).yAxisPadding(50).elasticX(!0).xAxisPadding(50).maxBubbleRelativeSize(.04).renderHorizontalGridLines(!0).renderVerticalGridLines(!0).renderLabel(!0).renderTitle(!0).yAxisLabel("# of Certified (Accepted) Applications").xAxisLabel("# of Total Applications").title(function(t){return t.key+"\nAverage Yearly Salary: "+e(t.value.average)+"M\n"+t.value.count+"Applied , and "+t.value.certified_count+" got a visa\n% Acceppted : "+e(t.value.certified_count/t.value.count)}),MultiViz.roundChart.yAxis().tickFormat(function(t){return t+""}),MultiViz.roundChart.xAxis().tickFormat(function(t){return t+""}),MultiViz.companiesChart.width(450).height(250).margins({top:10,right:50,bottom:30,left:40}).dimension(g).group(C).elasticY(!0).centerBar(!0).round(dc.round.floor).alwaysUseRounding(!0).x(d3.scale.linear().domain([0,1e5])).renderHorizontalGridLines(!0).filterPrinter(function(t){var i=t[0],r="";return r+=e(i[0])+"% -> "+e(i[1])+"%"}),MultiViz.companiesChart.xAxis().tickFormat(function(t){return t+"$"}),MultiViz.companiesChart.yAxis().ticks(8),MultiViz.jobTitleChart.width(180).height(180).margins({top:20,left:10,right:10,bottom:20}).group(n).dimension(r).ordinalColors(["#3182bd","#6baed6","#9ecae1","#c6dbef","#dadaeb"]).label(function(t){return t.key}).title(function(t){return t.value}).elasticX(!0).xAxis().ticks(4),dc.renderAll()})}};